FROM ubuntu:18.04

RUN apt-get update && apt-get -y upgrade
RUN apt-get install -y git build-essential autoconf bison re2c libxml2-dev zlib1g-dev nginx gdbserver

WORKDIR /tmp
COPY php-src/ /tmp/php-src/

RUN cd php-src && ./buildconf --force && ./configure --enable-fpm --without-pear --enable-debug && make -j4 && make install

COPY php-fpm.conf /usr/local/etc/
COPY nginx.server.conf /etc/nginx/sites-enabled/default

COPY script.php /var/www/html/script.php

COPY entrypoint.sh /
RUN chmod +x /entrypoint.sh

ENTRYPOINT /entrypoint.sh